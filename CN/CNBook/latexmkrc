# latexmk configuration for XeLaTeX + biber + shell-escape
# Use xelatex with optimizations
$pdflatex = 'xelatex -interaction=nonstopmode -synctex=1 -shell-escape -halt-on-error %O %S';

# biblatex via biber
$biber = 'biber %O %S';
$bibtex_use = 2;

# Enable continuous preview with -pvc if desired
$pvc_view_file_via_temporary = 0;

# Optimize for faster compilation
$max_repeat = 3;  # Reduced from 5 for faster builds
$pdf_mode = 5;    # Use xelatex

# Force regeneration of fls and fdb_latexmk files for better dependency tracking
$force_mode = 0;

# Clean up auxiliary files but keep tikz cache
$clean_ext = "aux log out synctex.gz toc bcf run.xml bbl blg fls fdb_latexmk";

# Always run biber when .bcf changes
add_cus_dep('bcf', 'bbl', 0, 'do_biber');
sub do_biber {
    my ($base_name, $path) = fileparse($_[0]);
    my $ret = system("biber", "$base_name");
    return $ret ? 12 : 0;
}
